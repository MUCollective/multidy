---
title: "Custom code engine"
author: "Abhraneel Sarma"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteIndexEntry{Custom code engine}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
library(knitr)
opts_chunk$set(echo = TRUE)
opts_knit$set(output.dir="vignettes")
library(dplyr)
library(tidyr)
library(multidy)
```

```{r}
M.2 = multiverse()
```

```{r}
M = multiverse()
M$x <- ~ 5

multiverse_table(M)$.code
```


```{r}
inside(M, {df <- data.frame( x = 1:10 ) %>%
  mutate(
    y = branch( values_y,
                "opt_1" ~ 0,
                "opt_2" ~ x + 1,
                "opt_3" ~ x^2 - 4
                )
  )
})
```

```{r}
inside(M.2, {
  df <- data.frame( x = 1:10, y = ((1:10)^2)/5 ) %>%
    mutate(
      z = branch( values_z,
                  "opt_1" ~ x + y,
                  "opt_2" ~ x * y,
                  "opt_3" ~ x^2 / y
                  )
    )
})
```
