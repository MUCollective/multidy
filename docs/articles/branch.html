<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>A discussion on branches in the multiverse • multiverse</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/lumnens/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="A discussion on branches in the multiverse">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">multiverse</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Conditions.html">Declaring conditions in the multiverse</a>
    </li>
    <li>
      <a href="../articles/branch.html">A discussion on branches in the multiverse</a>
    </li>
    <li>
      <a href="../articles/calculate-mean-multiverse.html">The most basic multiverse example: calculating the mean</a>
    </li>
    <li>
      <a href="../articles/complete-multiverse-analysis.html">A complete implementation of a multiverse analysis</a>
    </li>
    <li>
      <a href="../articles/dance.html">Recreating `Adding inferential treatments to plots using Resampling and Animations` using multidy</a>
    </li>
    <li>
      <a href="../articles/frequentist-multiverse-analysis.html">A multiverse analysis of the efficiency of physical visualizations</a>
    </li>
    <li>
      <a href="../articles/multiverse-in-rmd.html">Using the multiverse in RMarkdown</a>
    </li>
    <li>
      <a href="../articles/visualizing-multiverse.html">Extracting and Visualizing the results of a multiverse analysis</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>A discussion on branches in the multiverse</h1>
                        <h4 class="author">Abhraneel Sarma</h4>
            
            <h4 class="date">2020-03-18</h4>
      
      
      <div class="hidden name"><code>branch.Rmd</code></div>

    </div>

    
    
<div id="branches-in-a-multiverse-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#branches-in-a-multiverse-analysis" class="anchor"></a>Branches in a multiverse analysis</h2>
<p>In a multiverse analysis, researchers identify sets of defensible analysis choices (e.g., different ways of excluding outliers, different data transformations), implement them all, and then report the outcomes of all analyses resulting from all possible choice combinations. Thus, a multiverse analysis consists of different paths or <strong>branches</strong> of analysis for the same problem.</p>
<p>For an example of how a branch might arise during analysis, let’s say that you have a variable, <span class="math inline">\(x\)</span>, which can assume any value between 1 and 60. You want to discretise this variable into two ordinal categories — <em>high</em> (if x &gt;= 30) and <em>low</em> (if x &lt; 30). However, another researcher might argue for discretising this variable into three ordinal categories — <em>high</em> (if x &gt;= 40), <em>medium</em> (if 20 &lt;= x &lt; 40), and <em>low</em> (if x &lt; 20).</p>
<p>An important aspect of this package is to make declaring such <strong>branches</strong> in the analysis more natural and convenient. Each <strong>branch</strong> is identified by a parameter, which can take two or more options. Thus, the different options are different branchings within the multiverse. A <strong>branch</strong> may be defined for:</p>
<ul>
<li><p><strong>Data substitution parameters</strong> which offer to switch between different raw datasets, either collected or simulated.</p></li>
<li><p><strong>Data processing parameters</strong> which offer to process the same raw data in different ways before it is analyzed.</p></li>
<li><p><strong>Modeling parameters</strong> offer different ways of analyzing the same processed data</p></li>
<li><p><strong>Presentation parameters</strong> offer different ways of presenting analysis outcomes</p></li>
</ul>
<p>In this document we describe different ways of declaring a <strong>branch</strong>, using different syntactical styles that are popular with R users, including base R syntax and tidyverse syntax.</p>
</div>
<div id="example-1-a-simple-branch" class="section level2">
<h2 class="hasAnchor">
<a href="#example-1-a-simple-branch" class="anchor"></a>Example 1: A simple branch</h2>
<p>Let’s say that there is a variable <code>x</code> which can take any of three different values — “low”, “medium”, “high”. We can perform the effect of encoding <code>x</code> as each of these values separately through separate branches. To do this, we first create a <strong>multiverse object</strong>, M and then declare <code>x</code> as three possible values within the multiverse using the <code><a href="../reference/branch.html">branch()</a></code> function.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">M =<span class="st"> </span><span class="kw"><a href="../reference/multiverse.html">multiverse</a></span>()</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1-3" data-line-number="3">M<span class="op">$</span>x &lt;-<span class="st"> </span><span class="er">~</span><span class="st"> </span><span class="kw"><a href="../reference/branch.html">branch</a></span>(a_parameter, <span class="st">"low"</span>, <span class="st">"medium"</span>, <span class="st">"high"</span>)</a>
<a class="sourceLine" id="cb1-4" data-line-number="4"></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="kw"><a href="../reference/accessors.html">multiverse_table</a></span>(M) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="st">  </span><span class="kw">select</span>(.universe, <span class="kw">everything</span>())</a></code></pre></div>
<pre><code>## # A tibble: 3 x 5
##   .universe a_parameter .parameter_assignment .code      .results
##       &lt;int&gt; &lt;chr&gt;       &lt;list&gt;                &lt;list&gt;     &lt;list&gt;  
## 1         1 low         &lt;named list [1]&gt;      &lt;list [1]&gt; &lt;env&gt;   
## 2         2 medium      &lt;named list [1]&gt;      &lt;list [1]&gt; &lt;env&gt;   
## 3         3 high        &lt;named list [1]&gt;      &lt;list [1]&gt; &lt;env&gt;</code></pre>
</div>
<div id="example-2-a-branch-within-functions-in-a-dplyr" class="section level2">
<h2 class="hasAnchor">
<a href="#example-2-a-branch-within-functions-in-a-dplyr" class="anchor"></a>Example 2: A branch within functions in a dplyr %&gt;%</h2>
<p>Let’s say that we have some data which indicates the amount of time spent by a user in four different conditions, 1, 2, 3 and 4.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"userlogs"</span>)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">data.userlogs.raw =<span class="st"> </span>userlogs <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>( <span class="dt">modality =</span> <span class="kw"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(modality) ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="st">  </span><span class="kw">arrange</span>(modality) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">index =</span> <span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="dv">1</span><span class="op">:</span>(<span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(.)<span class="op">/</span><span class="dv">4</span>)), <span class="dv">4</span>))</a></code></pre></div>
<p>The data variable <code>duration</code> is approximately normally distributed, however, as is common with such data it has a long right-tail. Before using a regression model, we can choose to either log-transform the data, or assume that it is normally distribution and analyse it. We can perform both analysis in our multiverse by declaring two branches — one where the variable is log-transformed and the other where it is not.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">M =<span class="st"> </span><span class="kw"><a href="../reference/multiverse.html">multiverse</a></span>()</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"></a>
<a class="sourceLine" id="cb4-3" data-line-number="3">M<span class="op">$</span>df &lt;-<span class="st"> </span><span class="er">~</span><span class="st"> </span>data.userlogs.raw <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="st">      </span><span class="kw">select</span>(modality, duration) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="st">      </span><span class="kw">mutate</span>( <span class="dt">duration =</span> <span class="kw"><a href="../reference/branch.html">branch</a></span>( data_transform, </a>
<a class="sourceLine" id="cb4-6" data-line-number="6">                       <span class="st">"none"</span> <span class="op">~</span><span class="st"> </span>duration,</a>
<a class="sourceLine" id="cb4-7" data-line-number="7">                       <span class="st">"log"</span> <span class="op">~</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(duration)</a>
<a class="sourceLine" id="cb4-8" data-line-number="8">      ))</a>
<a class="sourceLine" id="cb4-9" data-line-number="9"></a>
<a class="sourceLine" id="cb4-10" data-line-number="10"><span class="kw"><a href="../reference/accessors.html">multiverse_table</a></span>(M)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 5
##   .universe data_transform .parameter_assignment .code      .results
##       &lt;int&gt; &lt;chr&gt;          &lt;list&gt;                &lt;list&gt;     &lt;list&gt;  
## 1         1 none           &lt;named list [1]&gt;      &lt;list [1]&gt; &lt;env&gt;   
## 2         2 log            &lt;named list [1]&gt;      &lt;list [1]&gt; &lt;env&gt;</code></pre>
<p>The <code>multiverse_table</code> shows that there are two rows for each branch. If we look at the code column, we see that the variable <code>duration</code> is defined in two separate ways:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw"><a href="../reference/accessors.html">multiverse_table</a></span>(M)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 5
##   .universe data_transform .parameter_assignment .code      .results
##       &lt;int&gt; &lt;chr&gt;          &lt;list&gt;                &lt;list&gt;     &lt;list&gt;  
## 1         1 none           &lt;named list [1]&gt;      &lt;list [1]&gt; &lt;env&gt;   
## 2         2 log            &lt;named list [1]&gt;      &lt;list [1]&gt; &lt;env&gt;</code></pre>
</div>
<div id="example-3-a-branch-as-a-function" class="section level2">
<h2 class="hasAnchor">
<a href="#example-3-a-branch-as-a-function" class="anchor"></a>Example 3: A branch as a function</h2>
<p>Say we are not familiar with R’s tidyverse packages and it’s style of writing code. An alternate way of declaring a branch for transforming the <code>duration</code> variable in the analysis would be to use two separate functions for the transformation depending on which universe one is.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">M =<span class="st"> </span><span class="kw"><a href="../reference/multiverse.html">multiverse</a></span>()</a>
<a class="sourceLine" id="cb8-2" data-line-number="2"></a>
<a class="sourceLine" id="cb8-3" data-line-number="3">M<span class="op">$</span>duration &lt;-<span class="st"> </span><span class="er">~</span><span class="st"> </span><span class="kw"><a href="../reference/branch.html">branch</a></span>(data_trans,</a>
<a class="sourceLine" id="cb8-4" data-line-number="4">    <span class="st">"log-transformed"</span> <span class="op">~</span><span class="st"> </span>log,</a>
<a class="sourceLine" id="cb8-5" data-line-number="5">    <span class="st">"untransformed"</span> <span class="op">~</span><span class="st"> </span>identity</a>
<a class="sourceLine" id="cb8-6" data-line-number="6">  )(data.userlogs.raw<span class="op">$</span>duration)</a>
<a class="sourceLine" id="cb8-7" data-line-number="7"></a>
<a class="sourceLine" id="cb8-8" data-line-number="8"><span class="kw"><a href="../reference/execute.html">execute_multiverse</a></span>(M)</a></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw"><a href="../reference/accessors.html">multiverse_table</a></span>(M) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="st">  </span><span class="kw">unnest</span>( <span class="dt">transformed_duration =</span> <span class="kw">map</span>(.results, <span class="st">"duration"</span> ) ) <span class="op">%&gt;%</span><span class="st">  </span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>()</a></code></pre></div>
<pre><code>## Warning: unnest() has a new interface. See ?unnest for details.
## Try `df %&gt;% unnest(c(transformed_duration))`, with `mutate()` if needed</code></pre>
<pre><code>## # A tibble: 6 x 6
##   .universe data_trans    .parameter_assignm… .code   .results transformed_dura…
##       &lt;int&gt; &lt;chr&gt;         &lt;list&gt;              &lt;list&gt;  &lt;list&gt;               &lt;dbl&gt;
## 1         1 log-transfor… &lt;named list [1]&gt;    &lt;list … &lt;env&gt;                 4.25
## 2         1 log-transfor… &lt;named list [1]&gt;    &lt;list … &lt;env&gt;                 4.80
## 3         1 log-transfor… &lt;named list [1]&gt;    &lt;list … &lt;env&gt;                 3.89
## 4         1 log-transfor… &lt;named list [1]&gt;    &lt;list … &lt;env&gt;                 3.75
## 5         1 log-transfor… &lt;named list [1]&gt;    &lt;list … &lt;env&gt;                 4.01
## 6         1 log-transfor… &lt;named list [1]&gt;    &lt;list … &lt;env&gt;                 3.41</code></pre>
<p>As you can see, this creates, in each universe within the multiverse, a vector named <code>duration</code> which is either untransformed or log-transformed. However, this suffers from being slightly unintuitive as it is harder to read or write the code. What is actually happening here is that the entire <code><a href="../reference/branch.html">branch(...)</a></code> gets replaced with either <code><a href="https://rdrr.io/r/base/Log.html">log()</a></code> or <code><a href="https://rdrr.io/r/base/identity.html">identity()</a></code> within a given universe.</p>
<p>A more readable pattern might be:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">M<span class="fl">.2</span> =<span class="st"> </span><span class="kw"><a href="../reference/multiverse.html">multiverse</a></span>()</a>
<a class="sourceLine" id="cb12-2" data-line-number="2"></a>
<a class="sourceLine" id="cb12-3" data-line-number="3">M<span class="fl">.2</span><span class="op">$</span>duration_transform &lt;-<span class="st"> </span><span class="er">~</span><span class="st"> </span><span class="kw"><a href="../reference/branch.html">branch</a></span>(data_trans,</a>
<a class="sourceLine" id="cb12-4" data-line-number="4">    <span class="st">"log-transformed"</span> <span class="op">~</span><span class="st"> </span>log,</a>
<a class="sourceLine" id="cb12-5" data-line-number="5">    <span class="st">"untransformed"</span> <span class="op">~</span><span class="st"> </span>identity</a>
<a class="sourceLine" id="cb12-6" data-line-number="6">  )</a>
<a class="sourceLine" id="cb12-7" data-line-number="7"></a>
<a class="sourceLine" id="cb12-8" data-line-number="8">M<span class="fl">.2</span><span class="op">$</span>duration &lt;-<span class="st"> </span><span class="er">~</span><span class="st"> </span><span class="kw">duration_transform</span>(data.userlogs.raw<span class="op">$</span>duration)</a>
<a class="sourceLine" id="cb12-9" data-line-number="9"></a>
<a class="sourceLine" id="cb12-10" data-line-number="10"><span class="kw"><a href="../reference/execute.html">execute_multiverse</a></span>(M<span class="fl">.2</span>)</a></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="kw"><a href="../reference/accessors.html">multiverse_table</a></span>(M<span class="fl">.2</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="st">  </span><span class="kw">unnest</span>( <span class="dt">transformed_duration =</span> <span class="kw">map</span>(.results, <span class="st">"duration"</span> ) ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb13-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>()</a></code></pre></div>
<pre><code>## Warning: unnest() has a new interface. See ?unnest for details.
## Try `df %&gt;% unnest(c(transformed_duration))`, with `mutate()` if needed</code></pre>
<pre><code>## # A tibble: 6 x 6
##   .universe data_trans    .parameter_assignm… .code   .results transformed_dura…
##       &lt;int&gt; &lt;chr&gt;         &lt;list&gt;              &lt;list&gt;  &lt;list&gt;               &lt;dbl&gt;
## 1         1 log-transfor… &lt;named list [1]&gt;    &lt;list … &lt;env&gt;                 4.25
## 2         1 log-transfor… &lt;named list [1]&gt;    &lt;list … &lt;env&gt;                 4.80
## 3         1 log-transfor… &lt;named list [1]&gt;    &lt;list … &lt;env&gt;                 3.89
## 4         1 log-transfor… &lt;named list [1]&gt;    &lt;list … &lt;env&gt;                 3.75
## 5         1 log-transfor… &lt;named list [1]&gt;    &lt;list … &lt;env&gt;                 4.01
## 6         1 log-transfor… &lt;named list [1]&gt;    &lt;list … &lt;env&gt;                 3.41</code></pre>
</div>
<div id="example-4-parameters-can-be-reused" class="section level2">
<h2 class="hasAnchor">
<a href="#example-4-parameters-can-be-reused" class="anchor"></a>Example 4: Parameters can be reused</h2>
<p>If you want to use a parameter multiple times, or just want to define it upfront, you can assign it to a variable and use the variable in your code. For example, in the next example, we declare <em>three different branches</em> for data transformation, data modelling and data presentation respectively. We also define any necessary functions along the way.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(boot)</a>
<a class="sourceLine" id="cb16-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(broom)</a>
<a class="sourceLine" id="cb16-3" data-line-number="3">samplemean &lt;-<span class="st"> </span><span class="cf">function</span>(x, d) {<span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(x[d]))}</a>
<a class="sourceLine" id="cb16-4" data-line-number="4"></a>
<a class="sourceLine" id="cb16-5" data-line-number="5">M =<span class="st"> </span><span class="kw"><a href="../reference/multiverse.html">multiverse</a></span>()</a>
<a class="sourceLine" id="cb16-6" data-line-number="6"></a>
<a class="sourceLine" id="cb16-7" data-line-number="7">M<span class="op">$</span>data_trans &lt;-<span class="st"> </span><span class="er">~</span><span class="st"> </span><span class="kw"><a href="../reference/branch.html">branch</a></span>(data_trans,</a>
<a class="sourceLine" id="cb16-8" data-line-number="8">    <span class="st">"log-transformed"</span> <span class="op">~</span><span class="st"> </span>log,</a>
<a class="sourceLine" id="cb16-9" data-line-number="9">    <span class="st">"untransformed"</span> <span class="op">~</span><span class="st"> </span>identity</a>
<a class="sourceLine" id="cb16-10" data-line-number="10">  )</a>
<a class="sourceLine" id="cb16-11" data-line-number="11"></a>
<a class="sourceLine" id="cb16-12" data-line-number="12">t_test_ci &lt;-<span class="st"> </span><span class="cf">function</span>(x, y) {</a>
<a class="sourceLine" id="cb16-13" data-line-number="13">    broom<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/broom/man/reexports.html">tidy</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/t.test.html">t.test</a></span>(x, <span class="dt">conf.level =</span> y))</a>
<a class="sourceLine" id="cb16-14" data-line-number="14">}</a>
<a class="sourceLine" id="cb16-15" data-line-number="15"></a>
<a class="sourceLine" id="cb16-16" data-line-number="16">bootstrapped_ci &lt;-<span class="st"> </span><span class="cf">function</span>(x, y) {</a>
<a class="sourceLine" id="cb16-17" data-line-number="17">    <span class="kw"><a href="https://rdrr.io/pkg/boot/man/boot.html">boot</a></span>(<span class="dt">data =</span> x, <span class="dt">statistic =</span> samplemean, <span class="dt">R =</span> <span class="dv">5000</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb16-18" data-line-number="18"><span class="st">        </span>broom<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/broom/man/reexports.html">tidy</a></span>( <span class="dt">conf.int =</span> <span class="ot">TRUE</span>, <span class="dt">conf.method =</span> <span class="st">"bca"</span>, <span class="dt">conf.level =</span>  y) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb16-19" data-line-number="19"><span class="st">        </span><span class="kw">rename</span>(<span class="dt">estimate =</span> statistic)</a>
<a class="sourceLine" id="cb16-20" data-line-number="20">}</a>
<a class="sourceLine" id="cb16-21" data-line-number="21"></a>
<a class="sourceLine" id="cb16-22" data-line-number="22">M<span class="op">$</span>fit &lt;-<span class="st"> </span><span class="er">~</span><span class="st"> </span><span class="kw"><a href="../reference/branch.html">branch</a></span>(bootstrap,</a>
<a class="sourceLine" id="cb16-23" data-line-number="23">              <span class="st">"t-dist"</span> <span class="op">~</span><span class="st"> </span>t_test_ci,</a>
<a class="sourceLine" id="cb16-24" data-line-number="24">              <span class="st">"bca"</span> <span class="op">~</span><span class="st"> </span>bootstrapped_ci</a>
<a class="sourceLine" id="cb16-25" data-line-number="25">          )</a>
<a class="sourceLine" id="cb16-26" data-line-number="26"></a>
<a class="sourceLine" id="cb16-27" data-line-number="27">M<span class="op">$</span>ci &lt;-<span class="st"> </span><span class="er">~</span><span class="st"> </span><span class="kw"><a href="../reference/branch.html">branch</a></span>( ci, <span class="fl">0.5</span>, <span class="fl">0.68</span>, <span class="fl">0.95</span>, <span class="fl">0.99</span> )</a></code></pre></div>
<p>We then write the anaysis and use those variables to indicate branches in our analysis within the multiverse.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">M<span class="op">$</span>df &lt;-<span class="st"> </span><span class="er">~</span><span class="st"> </span>data.userlogs.raw  <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>( <span class="dt">duration =</span> <span class="kw">data_trans</span>(duration) ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb17-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>( <span class="dt">modality.f =</span> <span class="kw"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(modality) ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-4" data-line-number="4"><span class="st">  </span><span class="kw">group_by</span>(subject, modality.f, modalityname) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb17-5" data-line-number="5"><span class="st">  </span><span class="kw">summarise</span>( <span class="dt">duration =</span> <span class="kw"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(duration) ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-6" data-line-number="6"><span class="st">  </span><span class="kw">group_by</span>(modality.f) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-7" data-line-number="7"><span class="st">  </span><span class="kw">rename</span>( <span class="dt">value =</span> duration ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-8" data-line-number="8"><span class="st">  </span><span class="kw">summarise</span>( <span class="dt">data =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(value) )</a>
<a class="sourceLine" id="cb17-9" data-line-number="9"></a>
<a class="sourceLine" id="cb17-10" data-line-number="10">M<span class="op">$</span>df &lt;-<span class="st"> </span><span class="er">~</span><span class="st"> </span>df <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-11" data-line-number="11"><span class="st">  </span><span class="kw">mutate</span>( <span class="dt">fit =</span> <span class="kw">map</span>(data, <span class="op">~</span><span class="st"> </span><span class="kw">fit</span>(.x, ci) ) ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-12" data-line-number="12"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>data) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-13" data-line-number="13"><span class="st">  </span><span class="kw">unnest</span>( <span class="dt">cols =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(fit) )</a>
<a class="sourceLine" id="cb17-14" data-line-number="14"></a>
<a class="sourceLine" id="cb17-15" data-line-number="15"><span class="kw"><a href="../reference/execute.html">execute_multiverse</a></span>(M)</a></code></pre></div>
<p>To see the results of using branches, we plot a part of this multiverse. We see the different transformations (no transformations in the right column and log-transform in the left column). Each row shows the different data presentation branches by presenting different confidence levels.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="kw"><a href="../reference/accessors.html">multiverse_table</a></span>(M) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb18-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">df =</span> <span class="kw">map</span>(.results, <span class="st">"df"</span> ) ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb18-3" data-line-number="3"><span class="st">  </span><span class="kw">unnest</span>( <span class="dt">cols =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(df) )  <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb18-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>( <span class="dt">modality.f =</span> <span class="kw">recode</span>( modality.f, </a>
<a class="sourceLine" id="cb18-5" data-line-number="5">                 <span class="st">"1"</span> =<span class="st"> "physical-touch"</span>,</a>
<a class="sourceLine" id="cb18-6" data-line-number="6">                 <span class="st">"2"</span> =<span class="st"> "no-touch"</span>,</a>
<a class="sourceLine" id="cb18-7" data-line-number="7">                 <span class="st">"3"</span> =<span class="st"> "virtual-prop"</span>,</a>
<a class="sourceLine" id="cb18-8" data-line-number="8">                 <span class="st">"4"</span> =<span class="st"> "virtual-mouse"</span></a>
<a class="sourceLine" id="cb18-9" data-line-number="9">  ) ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb18-10" data-line-number="10"><span class="st">  </span><span class="kw">mutate</span>( </a>
<a class="sourceLine" id="cb18-11" data-line-number="11">    <span class="dt">estimate =</span> <span class="kw"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(data_trans <span class="op">==</span><span class="st"> "log"</span>, <span class="kw"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(estimate), estimate),</a>
<a class="sourceLine" id="cb18-12" data-line-number="12">    <span class="dt">conf.low =</span> <span class="kw"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(data_trans <span class="op">==</span><span class="st"> "log"</span>, <span class="kw"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(conf.low), conf.low),</a>
<a class="sourceLine" id="cb18-13" data-line-number="13">    <span class="dt">conf.high =</span> <span class="kw"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(data_trans <span class="op">==</span><span class="st"> "log"</span>, <span class="kw"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(conf.high), conf.high)</a>
<a class="sourceLine" id="cb18-14" data-line-number="14">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb18-15" data-line-number="15"><span class="st">  </span><span class="kw">arrange</span>(ci, <span class="kw">desc</span>(data_trans), <span class="kw">desc</span>(bootstrap)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb18-16" data-line-number="16"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>( bootstrap <span class="op">==</span><span class="st"> "bca"</span> ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb18-17" data-line-number="17"><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb18-18" data-line-number="18"><span class="st">  </span><span class="co">#geom_vline( xintercept = 0,  colour = '#979797' ) +</span></a>
<a class="sourceLine" id="cb18-19" data-line-number="19"><span class="st">  </span><span class="kw">geom_point</span>( <span class="kw">aes</span>(<span class="dt">x =</span> estimate, <span class="dt">y =</span> modality.f)) <span class="op">+</span></a>
<a class="sourceLine" id="cb18-20" data-line-number="20"><span class="st">  </span><span class="kw">geom_errorbarh</span>( <span class="kw">aes</span>(<span class="dt">xmin =</span> conf.low, <span class="dt">xmax =</span> conf.high, <span class="dt">y =</span> modality.f), <span class="dt">height =</span> <span class="dv">0</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb18-21" data-line-number="21"><span class="st">  </span><span class="kw">facet_grid</span>(ci <span class="op">~</span><span class="st"> </span>data_trans, <span class="dt">scales =</span> <span class="st">"free"</span>)</a></code></pre></div>
<p><img src="branch_files/figure-html/unnamed-chunk-11-1.png" width="768"></p>
</div>
<div id="example-5-declaring-continuous-variables-in-branch" class="section level2">
<h2 class="hasAnchor">
<a href="#example-5-declaring-continuous-variables-in-branch" class="anchor"></a>Example 5: Declaring continuous variables in <code>branch</code>
</h2>
<p>So far we have only looked at examples where we declare parameters within a branch which takes discrete values. In most cases, it makes sense to declare them separately and if the number of values for a discrete variable is not oo high, sufficiently easy and concise to declare them in this manner. However, this does not apply to continuous variables as declaring all possible values would be painstakingly difficult. Hence we provide a alternate way of declaring branches where the parameter takes a continuous sequence of values.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1">M =<span class="st"> </span><span class="kw"><a href="../reference/multiverse.html">multiverse</a></span>()</a>
<a class="sourceLine" id="cb19-2" data-line-number="2"></a>
<a class="sourceLine" id="cb19-3" data-line-number="3"><span class="kw"><a href="../reference/inside.html">inside</a></span>(M, {</a>
<a class="sourceLine" id="cb19-4" data-line-number="4">  <span class="kw"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="kw"><a href="../reference/branch.html">branch</a></span>(seed, <span class="dt">.options =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">25</span>))</a>
<a class="sourceLine" id="cb19-5" data-line-number="5">  </a>
<a class="sourceLine" id="cb19-6" data-line-number="6">  x1 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="dv">25</span>)</a>
<a class="sourceLine" id="cb19-7" data-line-number="7">  x2 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="dv">25</span>)</a>
<a class="sourceLine" id="cb19-8" data-line-number="8">  y &lt;-<span class="st"> </span>x1 <span class="op">+</span><span class="st"> </span>x2 <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span>(<span class="dv">25</span>)</a>
<a class="sourceLine" id="cb19-9" data-line-number="9"></a>
<a class="sourceLine" id="cb19-10" data-line-number="10">  m &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(y <span class="op">~</span><span class="st"> </span>x1<span class="op">+</span><span class="st"> </span>x2)</a>
<a class="sourceLine" id="cb19-11" data-line-number="11"></a>
<a class="sourceLine" id="cb19-12" data-line-number="12">  intervals &lt;-<span class="st"> </span>broom<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/broom/man/reexports.html">tidy</a></span>(m, <span class="dt">conf.int =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb19-13" data-line-number="13">})</a>
<a class="sourceLine" id="cb19-14" data-line-number="14"></a>
<a class="sourceLine" id="cb19-15" data-line-number="15"><span class="kw"><a href="../reference/execute.html">execute_multiverse</a></span>(M)</a></code></pre></div>
<p>We then plot the estimates from the multiverse to see if we obtain the correct results:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="kw"><a href="../reference/accessors.html">multiverse_table</a></span>(M) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">df =</span> <span class="kw">map</span>(.results, <span class="st">"intervals"</span> ) ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-3" data-line-number="3"><span class="st">  </span><span class="kw">unnest</span>( <span class="dt">cols =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(df) ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-4" data-line-number="4"><span class="st">  </span><span class="kw">unnest</span>(seed) <span class="op">%&gt;%</span><span class="st">  </span><span class="co"># won't be necessary once issue #34 is fixed</span></a>
<a class="sourceLine" id="cb20-5" data-line-number="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> .universe, <span class="dt">y =</span> estimate, <span class="dt">ymin =</span> conf.low, <span class="dt">ymax =</span> conf.high), <span class="dt">alpha =</span> <span class="fl">0.5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb20-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_pointrange</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb20-7" data-line-number="7"><span class="st">  </span><span class="kw">facet_grid</span>( . <span class="op">~</span><span class="st"> </span>term )  <span class="op">+</span></a>
<a class="sourceLine" id="cb20-8" data-line-number="8"><span class="st">  </span><span class="kw">scale_x_continuous</span>( <span class="dt">breaks =</span> <span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="dv">0</span>, <span class="dv">25</span>, <span class="dt">by =</span> <span class="dv">5</span>) ) <span class="op">+</span></a>
<a class="sourceLine" id="cb20-9" data-line-number="9"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">"Universe (i.e. the seed parameter)"</span>, <span class="dt">y =</span> <span class="st">"Model Parameter Values"</span>, <span class="dt">title =</span> <span class="st">"Estimates with 95% confidence intervals"</span>)</a></code></pre></div>
<p><img src="branch_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#branches-in-a-multiverse-analysis">Branches in a multiverse analysis</a></li>
      <li><a href="#example-1-a-simple-branch">Example 1: A simple branch</a></li>
      <li><a href="#example-2-a-branch-within-functions-in-a-dplyr">Example 2: A branch within functions in a dplyr %&gt;%</a></li>
      <li><a href="#example-3-a-branch-as-a-function">Example 3: A branch as a function</a></li>
      <li><a href="#example-4-parameters-can-be-reused">Example 4: Parameters can be reused</a></li>
      <li><a href="#example-5-declaring-continuous-variables-in-branch">Example 5: Declaring continuous variables in <code>branch</code></a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="http://abhsarma.github.io">Abhraneel Sarma</a>, <a href="http://www.mjskay.com">Matthew Kay</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
