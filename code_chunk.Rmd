---
title: "code_chunk"
author: "Abhraneel Sarma"
date: "11/25/2019"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteIndexEntry{The most basic multiverse example: calculating the mean}
  %\usepackage[UTF-8]{inputenc}
---


```{r setup, include=FALSE}
library(knitr)
#opts_knit$set(
#  echo = TRUE,
#  fig.width = 6, 
#  fig.height = 4,
#  output.dir="vignettes"
#)

library(dplyr)
library(tidyr)
library(purrr)
library(rlang)
library(ggplot2)
#library(multiverse)
```


```{r}
speed_data <- data.frame( 
    speed = rlnorm(100, log(200), 1), 
    device = sample(c("smartphone", "laptop", "tablet"), 100, TRUE, prob= c(0.1, 0.65, 0.25)) 
  )

median = median(speed_data$speed)
iqr = IQR(speed_data$speed, na.rm=TRUE)

M = multiverse()
```


```{multiverse label = default-m-1, inside = M}
result_analysis <- speed_data %>% 
  filter(speed < median + 3 * iqr & speed > 10) %>%
  filter(branch(device,
    "default" ~ device != "smartphone",
    "strict" ~ !device %in% c("smartphone", "other") & !is.na(device)
  ))

#result_analysis
x <- 10

x
```


```{multiverse label = default-m-2, inside = M}
result_analysis <- speed_data %>%
  filter(branch(outlier,
    "default" ~ speed < median + 3 * iqr & speed > 10,
    "strict" ~ speed < median + 2 * iqr & speed > 10
  ))

result_analysis
```

```{r}
code(M)
```



```{r}
M = multiverse()

inside(M, {
  result_analysis <- speed_data %>%
      filter(branch(outlier,
        "default" ~ speed < median + 3 * iqr & speed > 10,
        "strict" ~ speed < median + 2 * iqr & speed > 10
      ))
  }, "label1")

inside(M, {
  result_analysis <- speed_data %>%
      filter(branch(device,
        "default" ~ device != "smartphone",
        "strict" ~ !device %in% c("smartphone", "other") & !is.na(device)
      ))
  }, "label2")



default_parameter_assignment(M)
```

```{multiverse label = default-m-2, inside = M}
result_analysis <- result_analysis %>%
  filter(branch(device,
    "default" ~ device != "smartphone",
    "strict" ~ !device %in% c("smartphone", "other") & !is.na(device)
  ))
```



```{r}
multiverse_table(M)#[['.code']][[1]]


M = multiverse()

test_fun <- function(.code, .name = NULL){
  .c = list()
  
  if (is.null(.name)) append(.c, .code) else .c[[.name]] = .code
  .c
}

test_fun(1231, "x")
test_fun(1231)
```



```{r prepare_data, message=FALSE}
speed_data <- readr::read_csv('data/speed_data.csv')
#calculate reading speed in WPM
speed_data$speed <- speed_data$num_words/(speed_data$adjust_rt/60000)

#remove retake participants
speed_data <- subset(speed_data, retake != 1)

head(speed_data)
```
